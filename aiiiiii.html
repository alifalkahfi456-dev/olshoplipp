<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lipp Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
--bg:#0b0f14;--panel:#0f1623;--card:#121a2b;
--soft:#1e293b;--text:#e5e7eb;--muted:#9ca3af;
--accent:#7c7cff;--ok:#22c55e;--err:#ef4444
}
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter}
body{background:var(--bg);color:var(--text)}

.header{height:64px;display:flex;align-items:center;gap:14px;
padding:0 22px;background:#0f1623;position:sticky;top:0;z-index:100}
.menu-btn{width:40px;height:40px;border-radius:12px;cursor:pointer;
display:flex;align-items:center;justify-content:center}
.menu-btn:hover{background:var(--soft)}
.menu-btn span,.menu-btn span:before,.menu-btn span:after{
width:18px;height:2px;background:#fff;display:block;position:relative}
.menu-btn span:before,.menu-btn span:after{content:"";position:absolute;left:0}
.menu-btn span:before{top:-6px}
.menu-btn span:after{top:6px}

.sidebar{position:fixed;top:0;left:-260px;width:260px;height:100%;
background:var(--panel);padding:26px;transition:.35s;z-index:200}
.sidebar.active{left:0}
.sidebar a{display:block;padding:12px;border-radius:14px;
color:var(--muted);margin-bottom:10px;cursor:pointer}
.sidebar a:hover{background:var(--soft);color:#fff}

.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);
opacity:0;pointer-events:none;transition:.3s;z-index:150}
.overlay.show{opacity:1;pointer-events:auto}

.content{padding:26px;max-width:1200px;margin:auto}
.section{display:none}
.section.active{display:block}

.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:22px}
.card{background:linear-gradient(180deg,#141d33,#0f172a);border-radius:22px;padding:20px}
.card h4{color:var(--muted);font-size:.8rem}
.card strong{font-size:1.6rem}

.chart-wrap{margin-top:22px;background:linear-gradient(180deg,#141d33,#0f172a);
border-radius:22px;padding:18px}
canvas{width:100%;height:240px}

.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:22px}
.product{background:linear-gradient(180deg,#141d33,#0f172a);
border-radius:22px;padding:14px;display:flex;flex-direction:column}
.product img{width:100%;border-radius:16px;margin-bottom:10px}
.product p{font-size:.85rem;color:var(--muted)}
.product .price{font-weight:600;margin:8px 0}
.product .actions{display:flex;gap:10px;margin-top:auto}

.btn{padding:11px;border:none;border-radius:14px;
background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
.btn.secondary{background:var(--soft)}

.box{max-width:440px;background:linear-gradient(180deg,#141d33,#0f172a);
padding:22px;border-radius:22px;margin-bottom:20px}
.box input,.box textarea,.box select{
width:100%;padding:11px;margin-bottom:10px;
background:var(--soft);border:none;border-radius:14px;color:#fff}

.testi{background:linear-gradient(180deg,#141d33,#0f172a);
border-radius:18px;padding:14px;margin-bottom:12px}

.toast{position:fixed;bottom:30px;left:50%;
transform:translate(-50%,20px);padding:14px 20px;border-radius:16px;
opacity:0;transition:.3s;z-index:999;color:#fff}
.toast.show{opacity:1;transform:translate(-50%,0)}
.toast.ok{background:var(--ok)}
.toast.err{background:var(--err)}

footer{text-align:center;padding:24px;color:var(--muted)}
</style>
</head>

<body>

<audio id="bgm" src="https://files.catbox.moe/epwi28.mp4" autoplay loop></audio>

<div class="sidebar" id="sidebar">
<a onclick="nav('dashboard')">Dashboard</a>
<a onclick="nav('produk')">Produk</a>
<a onclick="nav('testi')">Testimoni</a>
<a id="adminMenu" onclick="nav('admin')">Admin</a>
</div>

<div class="overlay" id="overlay"></div>

<div class="header">
<div class="menu-btn" id="menuBtn"><span></span></div>
<strong id="pageTitle">Dashboard</strong>
<div style="margin-left:auto">
<button class="btn secondary" onclick="openCart()">üõí (<span id="cartCount">0</span>)</button>
</div>
</div>

<div class="content">

<div class="section active" id="dashboard">
<div class="cards">
<div class="card"><h4>Total Penjualan</h4><strong id="totalSales">Rp 0</strong></div>
<div class="card"><h4>Order</h4><strong id="orderCount">0</strong></div>
<div class="card"><h4>Rating</h4><strong id="avgRating">0.0 ‚≠ê</strong></div>
</div>
<div class="chart-wrap"><canvas id="chart"></canvas></div>
</div>

<div class="section" id="produk"><div class="products" id="productList"></div></div>

<div class="section" id="testi">
<div class="box">
<select id="userStar">
<option value="1">‚≠ê</option><option value="2">‚≠ê‚≠ê</option>
<option value="3">‚≠ê‚≠ê‚≠ê</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
<option value="5" selected>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
</select>
<textarea id="userTesti" placeholder="Pendapat kamu..."></textarea>
<button class="btn" onclick="submitTesti()">Kirim Testimoni</button>
</div>
<div id="testiList"></div>
</div>

<div class="section" id="admin">
<div class="box" id="loginBox">
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button class="btn" onclick="login()">Login Admin</button>
</div>

<div class="box" id="adminPanel" style="display:none">
<button class="btn secondary" onclick="resetAll()">RESET DATA</button><br><br>
<input id="pName" placeholder="Nama Produk">
<input id="pPrice" placeholder="Harga">
<input id="pImg" placeholder="URL Gambar">
<textarea id="pDesc" placeholder="Deskripsi"></textarea>
<button class="btn" onclick="addProduct()">Upload Produk</button>
</div>
</div>

</div>

<footer>¬© 2025 <strong>Lipp Shop</strong></footer>
<div class="toast" id="toast"></div>

<script>
/* ===== STORAGE ===== */
const TESTI_KEY="lipp_testi_v3";
const SALES_KEY="lipp_sales_v1";

/* ===== IP ===== */
const ALLOWED_IPS=["140.213.120.134"];
let ipAllowed=false;
fetch("https://api.ipify.org?format=json")
.then(r=>r.json())
.then(d=>{
if(!ALLOWED_IPS.includes(d.ip)) adminMenu.style.display="none";
else ipAllowed=true;
});

/* ===== UI ===== */
menuBtn.onclick=()=>{sidebar.classList.toggle("active");overlay.classList.toggle("show")}
overlay.onclick=menuBtn.onclick;
function nav(id){
document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
pageTitle.innerText=id;
menuBtn.onclick();
if(id==="dashboard") setTimeout(drawChart,50);
}

/* ===== DATA ===== */
let products=[],cart=[];
let testi=JSON.parse(localStorage.getItem(TESTI_KEY))||[];
let salesHistory=JSON.parse(localStorage.getItem(SALES_KEY))||[];

/* ===== ADMIN ===== */
function login(){
if(!ipAllowed) return toastMsg("IP tidak diizinkan","err");
if(user.value==="alip"&&pass.value==="2012"){
loginBox.style.display="none";adminPanel.style.display="block";
toastMsg("Login berhasil");
}else toastMsg("Login gagal","err");
}

/* ===== PRODUK ===== */
function addProduct(){
products.push({name:pName.value,price:+pPrice.value,img:pImg.value,desc:pDesc.value});
renderProducts();toastMsg("Produk ditambah");
}
function renderProducts(){
productList.innerHTML="";
products.forEach(p=>{
productList.innerHTML+=`
<div class="product">
<img src="${p.img}">
<strong>${p.name}</strong>
<p>${p.desc}</p>
<div class="price">Rp ${p.price}</div>
<div class="actions">
<button class="btn" onclick="checkout('${p.name}',${p.price})">Checkout</button>
<button class="btn secondary" onclick="addCart('${p.name}',${p.price})">Keranjang</button>
</div></div>`;
});
}

/* ===== CART ===== */
function addCart(n,p){cart.push({n,p});cartCount.innerText=cart.length;toastMsg("Masuk keranjang")}
function openCart(){
if(!cart.length)return toastMsg("Keranjang kosong","err");
let msg="Halo saya mau checkout:%0A",t=0;
cart.forEach(i=>{msg+=`- ${i.n} Rp ${i.p}%0A`;t+=i.p});
window.open(`https://wa.me/6281234567890?text=${encodeURIComponent(msg+"Total Rp "+t)}`);
}

/* ===== CHECKOUT ===== */
function checkout(n,p){
salesHistory.push({time:Date.now(),amount:p});
localStorage.setItem(SALES_KEY,JSON.stringify(salesHistory));
updateStats();drawChart();
window.open(`https://wa.me/6281957163995?text=${encodeURIComponent("Checkout "+n+" Rp "+p)}`);
}

/* ===== TESTI ===== */
function submitTesti(){
if(!userTesti.value.trim())return toastMsg("Testimoni kosong","err");
testi.push({star:+userStar.value,text:userTesti.value});
localStorage.setItem(TESTI_KEY,JSON.stringify(testi));
userTesti.value="";
renderTesti();updateRating();toastMsg("Testimoni terkirim ‚ù§Ô∏è");
}
function renderTesti(){
testiList.innerHTML="";
testi.forEach(t=>{
testiList.innerHTML+=`<div class="testi"><strong>${"‚≠ê".repeat(t.star)}</strong><p>${t.text}</p></div>`;
});
}
function updateRating(){
if(!testi.length){avgRating.innerText="0.0 ‚≠ê";return;}
let sum=testi.reduce((a,b)=>a+b.star,0);
avgRating.innerText=(sum/testi.length).toFixed(1)+" ‚≠ê";
}

/* ===== DASHBOARD ===== */
function updateStats(){
let total=salesHistory.reduce((a,b)=>a+b.amount,0);
totalSales.innerText="Rp "+total;
orderCount.innerText=salesHistory.length;
}

/* ===== CHART (REAL DATA) ===== */
const ctx=chart.getContext("2d");
function drawChart(){
chart.width=chart.offsetWidth;
chart.height=240;
ctx.clearRect(0,0,chart.width,chart.height);
if(!salesHistory.length) return;

let max=Math.max(...salesHistory.map(s=>s.amount));
ctx.beginPath();ctx.strokeStyle="#7c7cff";ctx.lineWidth=3;

salesHistory.forEach((s,i)=>{
let x=i*(chart.width/Math.max(salesHistory.length-1,1));
let y=chart.height-(s.amount/max)*chart.height;
i?ctx.lineTo(x,y):ctx.moveTo(x,y);
});
ctx.stroke();
}

/* ===== RESET ===== */
function resetAll(){
products=[];cart=[];testi=[];salesHistory=[];
localStorage.removeItem(TESTI_KEY);
localStorage.removeItem(SALES_KEY);
renderProducts();renderTesti();updateRating();updateStats();drawChart();
toastMsg("Semua data direset");
}

/* ===== TOAST ===== */
function toastMsg(m,t="ok"){
toast.textContent=m;toast.className=`toast ${t} show`;
setTimeout(()=>toast.classList.remove("show"),2500);
}

/* ===== INIT ===== */
renderTesti();updateRating();updateStats();drawChart();
document.body.addEventListener("click",()=>bgm.play(),{once:true});
</script>

</body>
</html>